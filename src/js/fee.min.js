!function(a){"use strict";window.wp=window.wp||{},wp.fee={},wp.heartbeat.interval(15),_.extend(wp.fee,window.fee),a(function(){function b(){H=!1,clearTimeout(I),I=setTimeout(function(){H=!0},3e5)}function c(){N&&(a("#wp-admin-bar-edit").addClass("active"),a("#wp-admin-bar-edit-in-page").hide(),Q.removeClass("fee-off").addClass("fee-on"),S.addClass("has-post-thumbnail"),p(function(a){a.show()}),J=i(),wp.autosave&&(wp.autosave.local.resume(),wp.autosave.server.resume()),P.trigger("fee-on"),N=!1)}function d(a){N||(l()?n(function(){e(a)}):e(a))}function e(b){wp.autosave&&(wp.autosave.local.suspend(),wp.autosave.server.suspend()),a("#wp-admin-bar-edit").removeClass("active"),a("#wp-admin-bar-edit-in-page").show(),Q.removeClass("fee-on").addClass("fee-off"),T.find("img").length||S.removeClass("has-post-thumbnail"),A&&A.length>0&&A.first().html(wp.fee.postOnServer.post_title),z.html(wp.fee.postOnServer.post_title),B&&(document.title=B.replace("<!--replace-->",wp.fee.postOnServer.post_title)),p(function(a){a.hide()}),P.trigger("fee-off"),N=!0,b&&(document.location.href=b)}function f(){N?c():d()}function g(){return!N}function h(){return N}function i(){var a={};return _.each(wp.fee.post,function(b,c){a[c]=b()}),a}function j(b,c){var d;P.trigger("fee-before-save"),d=i(),d.publish=c?!0:void 0,d.save=c?void 0:!0,d._wpnonce=wp.fee.nonces.post,Y.prop("disabled",!0),ja.start(),wp.ajax.post("fee_post",d).always(function(){Y.prop("disabled",!1),ja.stop()}).done(function(a){wp.fee.postOnServer=a.post,$.html(a.processedPostContent),window.wpCookies.set("wp-saving-post-"+wp.fee.postOnServer.ID,"saved"),w&&w.remove(),x&&x.remove(),a.message&&(x=o(a.message,"updated",!0)),m(),J=i(),P.trigger("fee-after-save"),b&&b()}).fail(function(b){b.message&&o(b.message,"error"),a.trim(b)&&a.trim(b.message)||o("There was an error when saving","error")})}function k(b){j(b,!0),a("#wp-admin-bar-edit-publish").hide(),a("#wp-admin-bar-edit-save > a").text("Update")}function l(){return N?void 0:_.some(arguments.length?arguments:["post_title","post_content"],function(a){return J[a]&&wp.fee.post[a]?wp.fee.post[a]()!==J[a]:void 0})}function m(){N||p(function(a){a.undoManager.add()})}function n(a){ba.show(),ba.find(".fee-exit").focus().on("click.fee",function(){a(),ba.hide()}),ba.find(".fee-save-and-exit").on("click.fee",function(){j(a),ba.hide()}),ba.find(".fee-cancel").on("click.fee",function(){ba.hide()})}function o(b,c,d){var e=a("<div>").addClass(c);return e.append("<p>"+b+"</p>"+(d===!0?"":'<div class="dashicons dashicons-dismiss"></div>')),ca.prepend(e),e.find(".dashicons-dismiss").on("click.fee",function(){e.remove()}),d===!0&&e.delay(5e3).fadeOut("slow",function(){e.remove()}),e}function p(a){_.each(ea,a)}function q(a){ea.push(a),a.on("init",function(){a.hide(),fa++,fa===ea.length&&P.trigger("fee-editor-init")})}function r(){a("button").prop("disabled",!0),wp.ajax.post("fee_take_over_edit",{_wpnonce:wp.fee.nonces.takeOverEdit,post_ID:wp.fee.post.ID()}).done(function(a){"success"==a.message&&(c(),ha=!0)})}function s(){wp.ajax.post("fee_get_post_lock_dialog",{_wpnonce:wp.fee.nonces.postLockDialog,post_ID:wp.fee.post.ID(),get_post_lock:"true"}).done(function(b){b.message&&(v(b.message),a(".post-locked-message").length>0?(d(),ha=!1):"success"==b.lock&&(c(),ha=!0,a(".post-edit-link").hide()))})}function t(){wp.ajax.post("wp-remove-post-lock",{_wpnonce:wp.fee.nonces.post,post_ID:wp.fee.post.ID(),active_post_lock:wp.fee.lock}),d(),ha=!1,a(".post-edit-link").show()}function u(){var b,c,d,e,f={};y=a(".fee-title"),z=y.parent(),y.remove(),A=[],!A.length&&z.each(function(b,c){a(c).parents().each(function(b,d){var e=a.inArray(d,da);return e>-1?(f[e]=f[e]||[],f[e].push(c),!1):void 0})});for(b in f){A=a(f[b]);break}A.length&&(z=z.not(A),B=A.text().length?document.title.replace(A.text(),"<!--replace-->"):document.title,A.addClass("fee-title"),c=wp.fee.permalink.replace(/(?:%pagename%|%postname%)/,'<ins><span class="fee-slug">'+(wp.fee.postOnServer.post_name||wp.fee.postOnServer.ID)+"</span></ins>"),wp.fee.permalink!==c&&A.after('<p class="fee-url">'+c+"</p>"),C=a(".fee-url").hide(),D=a(".fee-slug"),K.init({selector:".fee-title",theme:"fee",paste_as_text:!0,plugins:"paste",inline:!0,placeholder:M.title,entity_encoding:"raw",setup:function(a){E=a,q(a),a.on("setcontent keyup",function(){wp.fee.post.post_title(wp.fee.post.post_title(),!0)}),a.on("keydown",function(a){13===a.keyCode&&(G.focus(),a.preventDefault())}),a.on("activate focus",function(){d=!0,C.slideDown("fast")}),a.on("deactivate blur hide",function(){d=!1,setTimeout(function(){e||C.slideUp("fast",function(){G.nodeChanged()})},100)})}}),K.init({selector:".fee-slug",theme:"fee",paste_as_text:!0,plugins:"paste",inline:!0,setup:function(a){F=a,q(a),a.on("setcontent keyup",function(){a.dom.isEmpty(a.getBody())&&(D.get(0).innerHTML="")}),a.on("keydown",function(b){K.util.VK.ENTER===b.keyCode?b.preventDefault():K.util.VK.SPACEBAR===b.keyCode&&(b.preventDefault(),a.insertContent("-"))}),a.on("blur",function(){a.isDirty()&&wp.ajax.post("fee_slug",{post_ID:wp.fee.post.post_ID(),post_title:wp.fee.post.post_title(),post_name:wp.fee.post.post_name(),_wpnonce:wp.fee.nonces.slug}).done(function(a){F.setContent(a)})}),C.on("click.fee",function(){a.focus()}),a.on("activate focus",function(){e=!0}),a.on("deactivate blur hide",function(){e=!1,setTimeout(function(){d||C.slideUp("fast",function(){G.nodeChanged()})},100)})}}))}function v(b){0==a("#post-lock-dialog").length?a("#wp-link-wrap").after(b):a("#post-lock-dialog").replaceWith(b)}var w,x,y,z,A,B,C,D,E,F,G,H,I,J,K=window.tinymce,L=K.util.VK,M=window.feeL10n,N=!0,O=a(window),P=a(document),Q=a(document.body),R=a(".fee-post"),S=(a('a[href="#fee-edit-link"]'),a(".has-post-thumbnail")),T=a(".fee-thumbnail"),U=a(".fee-thumbnail-wrap"),V=a(".fee-edit-thumbnail").add(".fee-insert-thumbnail"),W=a(".fee-remove-thumbnail"),X=a(".fee-toolbar"),Y=X.find(".button").add(a(".fee-save-and-exit")),Z=a(".fee-content"),$=a(".fee-content-original"),aa=a(".fee-categories"),ba=a(".fee-leave"),ca=a("#fee-notice-area"),da=Z.parents(),ea=[],fa=0,ga=!0,ha=!1,ia=0,ja={start:function(){ia||(Q.addClass("progress"),Q.append('<div class="progress-modal"></div>')),ia++},stop:function(){ia&&ia--,ia||(Q.removeClass("progress"),a(".progress-modal").remove())}};wp.fee.post={},_.each(wp.fee.postOnServer,function(a,b){wp.fee.post[b]=function(){return wp.fee.postOnServer[b]}}),wp.fee.post.post_ID=function(){return wp.fee.postOnServer.ID||0},wp.fee.post.post_title=function(a,b){return a?(B&&(document.title=B.replace("<!--replace-->",a)),z.each(function(b,c){c.innerHTML=a}),b||(A.get(0).innerHTML=a),this.post_title()):E?E.getContent()||"":wp.fee.postOnServer.post_title},wp.fee.post.post_name=function(){return F?F.getContent()||"":""},wp.fee.post.post_content=function(a){var b;return a&&"raw"!==a&&"html"!==a?(G.undoManager.add(),G.setContent(a),this.post_content()):(b=G.getContent({format:a||"html"})||"","raw"!==a&&(b=b.replace(/<p>(?:<br ?\/?>|\u00a0|\uFEFF| )*<\/p>/g,"<p>&nbsp;</p>"),b=b.replace(/<p>\[/g,"["),b=b.replace(/\]<\/p>/g,"]"),b=b.replace(/<br \/>/g,""),b=b.replace(/<p>&nbsp;<\/p>/g,"<br />")),b)},wp.fee.post.post_category=function(){var b=[];return a('input[name="post_category[]"]:checked').each(function(){b.push(a(this).val())}),b},b(),K.init(_.extend(wp.fee.tinymce,{setup:function(a){G=a,window.wpActiveEditor=a.id,q(a),a.on("BeforeSetContent",function(a){a.content&&(a.content=a.content.replace(/<p>(?:&nbsp;|\s)+<\/p>/gi,"<p><br></p>"))})}})),u(),O.on("beforeunload.fee",function(a){return!N&&l()?((a||window.event).returnValue=M.saveAlert,M.saveAlert):void 0}).on("unload.fee-remove-lock",function(a){ga&&(a.target&&"#document"!==a.target.nodeName||wp&&wp.ajax.post("wp-remove-post-lock",{_wpnonce:wp.fee.nonces.post,post_ID:wp.fee.post.ID(),active_post_lock:wp.fee.lock}))}),P.on("fee-editor-init.fee",function(){(Q.hasClass("fee-on")||-1!==document.location.hash.indexOf("edit=true"))&&s(),Q.hasClass("fee-off")&&!T.find("img").length&&S.removeClass("has-post-thumbnail"),P.on("autosave-restore-post",function(a,b){wp.fee.post.post_title(b.post_title),wp.fee.post.post_content(b.content)}),J=i(),wp.fee.postOnServer.post_content!==wp.fee.post.post_content()&&window.console.log("The content on the server and the content in the editor is different. This may be due to errors.")}).on("autosave-enable-buttons.fee",function(){Y.prop("disabled",!1)}).on("autosave-disable-buttons.fee",function(){wp.heartbeat&&wp.heartbeat.hasConnectionError()||Y.prop("disabled",!0)}).on("keydown.fee",function(a){83===a.keyCode&&L.metaKeyPressed(a)&&(a.preventDefault(),j()),27===a.keyCode&&(a.preventDefault(),d(),ha=!1)}).on("heartbeat-send.fee-refresh-lock",function(a,b){1==ha&&(b["wp-refresh-post-lock"]={post_id:wp.fee.post.ID(),lock:wp.fee.lock})}).on("heartbeat-tick.fee-refresh-lock",function(b,c){var d,e,f=c["wp-refresh-post-lock"];f&&(f.lock_error?(d=a("#post-lock-dialog"),d.length&&!d.is(":visible")&&(wp.autosave&&(P.one("heartbeat-tick",function(){wp.autosave.server.suspend(),d.removeClass("saving").addClass("saved"),O.off("beforeunload.edit-post")}),d.addClass("saving"),wp.autosave.server.triggerSave()),f.lock_error.avatar_src&&(e=a('<img class="avatar avatar-64 photo" width="64" height="64" />').attr("src",f.lock_error.avatar_src.replace(/&amp;/g,"&")),d.find("div.post-locked-avatar").empty().append(e)),d.removeClass("hidden"),d.show().find(".currently-editing").text(f.lock_error.text),d.find(".wp-tab-first").focus(),ha=!1)):f.new_lock&&(wp.fee.lock=f.new_lock,ha=!0,a("#post-lock-dialog").hide()))}).on("heartbeat-send.fee-refresh-nonces",function(a,b){H&&(b["wp-refresh-post-nonces"]={post_id:wp.fee.post.ID(),post_nonce:wp.fee.nonces.post})}).on("heartbeat-tick.fee-refresh-nonces",function(a,c){var d=c["wp-refresh-post-nonces"];d&&(b(),d.heartbeatNonce&&(window.heartbeatSettings.nonce=d.heartbeatNonce))}).on("after-autosave",function(){w&&w.fadeOut("slow",function(){w.remove()})}).ready(function(a){0==a("#post-lock-dialog").length&&wp.ajax.post("fee_get_post_lock_dialog",{_wpnonce:wp.fee.nonces.postLockDialog,post_ID:wp.fee.post.ID()}).done(function(b){var c=b.message;c&&(v(c),a("#post-lock-dialog").hide())}),ha||Q.addClass("fee-off")}),aa.on("click.fee",function(b){N||(b.preventDefault(),a(".fee-category-modal").modal("show"))}),a(".fee-category-modal").on("hide.bs.modal",function(){wp.ajax.post("fee_categories",{nonce:wp.fee.nonces.categories,post_ID:wp.fee.post.ID(),separator:aa.data("separator"),parents:aa.data("parents"),post_category:wp.fee.post.post_category()}).done(function(a){aa.html(a)})}),R.find('a[rel="tag"]').on("click.fee",function(a){a.preventDefault()}),R.find("time").add(R.find(".entry-date")).on("click.fee",function(a){a.preventDefault()}),R.find('a[rel="author"]').on("click.fee",function(a){a.preventDefault()}),a("a").not('a[href^="#"]').on("click.fee",function(b){var c=a(this);l()&&!L.metaKeyPressed(b)&&(b.preventDefault(),n(function(){e(c.attr("href")),ha=!1}))}),a("#wp-admin-bar-edit-publish > a").on("click.fee",function(a){a.preventDefault(),k()}),a("#wp-admin-bar-edit-save > a").on("click.fee",function(a){a.preventDefault(),j()}),a("#wp-admin-bar-edit > a, #wp-admin-bar-edit-in-page > a").on("click.fee",function(a){a.preventDefault(),s()}),a(".post-edit-link").on("click.fee",function(a){a.preventDefault(),1==ha?t():s()}),a("#wp-admin-bar-edit-cancel > a").on("click.fee",function(a){a.preventDefault(),t()}),a("body").on("click.fee",'a[href="?get-post-lock=1#fee-edit-link"]',function(b){b.preventDefault(),r(),a("#post-lock-dialog").hide()}),-1!==a.inArray(wp.fee.post.post_status(),["publish","future","private"])&&(a("#wp-admin-bar-edit-publish").hide(),a("#wp-admin-bar-edit-save > a").text("Update")),wp.fee.notices.autosave&&(w=o(wp.fee.notices.autosave,"error")),_.extend(wp.media.featuredImage,{set:function(a){var b=wp.media.view.settings;b.post.featuredImageId=a,wp.media.post("fee_thumbnail",{post_ID:b.post.id,thumbnail_ID:b.post.featuredImageId,_wpnonce:b.post.nonce,size:T.data("size")}).done(function(a){U.html(a),T.removeClass("fee-thumbnail-active"),""===a?T.addClass("fee-empty"):T.removeClass("fee-empty")})}}),V.on("click.fee-edit-thumbnail",function(){wp.media.featuredImage.frame().open()}),W.on("click.fee-remove-thumbnail",function(){wp.media.featuredImage.set(-1)}),T.on("click.fee-thumbnail-active",function(){N||T.hasClass("fee-empty")||(T.addClass("fee-thumbnail-active"),P.on("click.fee-thumbnail-active",function(a){T.get(0)===a.target||T.has(a.target).length||(T.removeClass("fee-thumbnail-active"),P.off("click.fee-thumbnail-active"))}))}),a(".categorydiv").each(function(){var b,c,d,e,f,g=a(this).attr("id");d=g.split("-"),d.shift(),e=d.join("-"),f=e+"_tab","category"===e&&(f="cats"),a("a","#"+e+"-tabs").click(function(){var b=a(this).attr("href");return a(this).parent().addClass("tabs").siblings("li").removeClass("tabs"),a("#"+e+"-tabs").siblings(".tabs-panel").hide(),a(b).show(),"#"+e+"-all"===b?window.deleteUserSetting(f):window.setUserSetting(f,"pop"),!1}),window.getUserSetting(f)&&a('a[href="#'+e+'-pop"]',"#"+e+"-tabs").click(),a("#new"+e).one("focus",function(){a(this).val("").removeClass("form-input-tip")}),a("#new"+e).keypress(function(b){13===b.keyCode&&(b.preventDefault(),a("#"+e+"-add-submit").click())}),a("#"+e+"-add-submit").click(function(){a("#new"+e).focus()}),b=function(b){return a("#new"+e).val()?(b.data+="&"+a(":checked","#"+e+"checklist").serialize(),a("#"+e+"-add-submit").prop("disabled",!0),b):!1},c=function(b,c){var d,f=a("#new"+e+"_parent");a("#"+e+"-add-submit").prop("disabled",!1),"undefined"!==c.parsed.responses[0]&&(d=c.parsed.responses[0].supplemental.newcat_parent)&&(f.before(d),f.remove())},a("#"+e+"checklist").wpList({alt:"",response:e+"-ajax-response",addBefore:b,addAfter:c}),a("#"+e+"-add-toggle").click(function(){return a("#"+e+"-adder").toggleClass("wp-hidden-children"),a('a[href="#'+e+'-all"]',"#"+e+"-tabs").click(),a("#new"+e).focus(),!1}),a("#"+e+"checklist, #"+e+"checklist-pop").on("click",'li.popular-category > label input[type="checkbox"]',function(){var b=a(this),c=b.is(":checked"),d=b.val();d&&b.parents("#taxonomy-"+e).length&&a("#in-"+e+"-"+d+", #in-popular-"+e+"-"+d).prop("checked",c)})}),_.extend(wp.fee,{on:c,off:d,toggle:f,isOn:g,isOff:h,isDirty:l,save:j,publish:k,addNotice:o,getPost:i})})}(jQuery);