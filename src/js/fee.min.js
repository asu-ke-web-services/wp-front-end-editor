!function(a){"use strict";window.wp=window.wp||{},wp.fee={},wp.heartbeat.interval(15),_.extend(wp.fee,window.fee),a(function(){function b(){D=!1,clearTimeout(E),E=setTimeout(function(){D=!0},3e5)}function c(){J&&(a("#wp-admin-bar-edit").addClass("active"),M.removeClass("fee-off").addClass("fee-on"),P.addClass("has-post-thumbnail"),p(function(a){a.show()}),F=i(),wp.autosave&&(wp.autosave.local.resume(),wp.autosave.server.resume()),L.trigger("fee-on"),J=!1)}function d(a){J||"auto-draft"===wp.fee.post.post_status()||(l()?n(function(){e(a)}):e(a))}function e(b){wp.autosave&&(wp.autosave.local.suspend(),wp.autosave.server.suspend()),a("#wp-admin-bar-edit").removeClass("active"),M.removeClass("fee-on").addClass("fee-off"),Q.find("img").length||P.removeClass("has-post-thumbnail"),w.html(wp.fee.postOnServer.post_title),v.html(wp.fee.postOnServer.post_title),x&&(document.title=x.replace("<!--replace-->",wp.fee.postOnServer.post_title)),p(function(a){a.hide()}),L.trigger("fee-off"),J=!0,b&&(document.location.href=b)}function f(){J?c():d()}function g(){return!J}function h(){return J}function i(){var a={};return _.each(wp.fee.post,function(b,c){a[c]=b()}),a}function j(a,b){var c;L.trigger("fee-before-save"),c=i(),c.publish=b?!0:void 0,c.save=b?void 0:!0,c._wpnonce=wp.fee.nonces.post,V.prop("disabled",!0),fa.start(),wp.ajax.post("fee_post",c).always(function(){V.prop("disabled",!1),fa.stop()}).done(function(b){wp.fee.postOnServer=b.post,X.html(b.processedPostContent),window.wpCookies.set("wp-saving-post-"+wp.fee.postOnServer.ID,"saved"),s&&s.remove(),t&&t.remove(),b.message&&(t=o(b.message,"updated",!0)),m(),F=i(),L.trigger("fee-after-save"),a&&a()}).fail(function(a){a.message&&o(a.message,"error")})}function k(b){j(b,!0),a("#wp-admin-bar-edit-publish").hide(),a("#wp-admin-bar-edit-save > a").text("Update")}function l(){return J?void 0:_.some(arguments.length?arguments:["post_title","post_content"],function(a){return F[a]&&wp.fee.post[a]?wp.fee.post[a]()!==F[a]:void 0})}function m(){J||p(function(a){a.undoManager.add()})}function n(a){Z.show(),Z.find(".fee-exit").focus().on("click.fee",function(){a(),Z.hide()}),Z.find(".fee-save-and-exit").on("click.fee",function(){j(a),Z.hide()}),Z.find(".fee-cancel").on("click.fee",function(){Z.hide()})}function o(b,c,d){var e=a("<div>").addClass(c);return e.append("<p>"+b+"</p>"+(d===!0?"":'<div class="dashicons dashicons-dismiss"></div>')),$.prepend(e),e.find(".dashicons-dismiss").on("click.fee",function(){e.remove(),d!==!0&&d()}),d===!0&&e.delay(5e3).fadeOut("slow",function(){e.remove()}),e}function p(a){_.each(ba,a)}function q(a){ba.push(a),a.on("init",function(){a.hide(),ca++,ca===ba.length&&L.trigger("fee-editor-init")})}function r(){var b,c,d,e,f={};u=a(".fee-title"),v=u.parent(),u.remove(),w=[],!w.length&&v.each(function(b,c){a(c).parents().each(function(b,d){var e=a.inArray(d,aa);return e>-1?(f[e]=f[e]||[],f[e].push(c),!1):void 0})});for(b in f){w=a(f[b]);break}w.length&&(v=v.not(w),x=w.text().length?document.title.replace(w.text(),"<!--replace-->"):document.title,w.addClass("fee-title"),c=wp.fee.permalink.replace(/(?:%pagename%|%postname%)/,'<ins><span class="fee-slug">'+(wp.fee.postOnServer.post_name||wp.fee.postOnServer.ID)+"</span></ins>"),wp.fee.permalink!==c&&w.after('<p class="fee-url">'+c+"</p>"),y=a(".fee-url").hide(),z=a(".fee-slug"),G.init({selector:".fee-title",theme:"fee",paste_as_text:!0,plugins:"paste",inline:!0,placeholder:I.title,entity_encoding:"raw",setup:function(a){A=a,q(a),a.on("setcontent keyup",function(){wp.fee.post.post_title(wp.fee.post.post_title(),!0)}),a.on("keydown",function(a){13===a.keyCode&&(C.focus(),a.preventDefault())}),a.on("activate focus",function(){d=!0,y.slideDown("fast")}),a.on("deactivate blur hide",function(){d=!1,setTimeout(function(){e||y.slideUp("fast",function(){C.nodeChanged()})},100)})}}),G.init({selector:".fee-slug",theme:"fee",paste_as_text:!0,plugins:"paste",inline:!0,setup:function(a){B=a,q(a),a.on("setcontent keyup",function(){a.dom.isEmpty(a.getBody())&&(z.get(0).innerHTML="")}),a.on("keydown",function(b){G.util.VK.ENTER===b.keyCode?b.preventDefault():G.util.VK.SPACEBAR===b.keyCode&&(b.preventDefault(),a.insertContent("-"))}),a.on("blur",function(){a.isDirty()&&wp.ajax.post("fee_slug",{post_ID:wp.fee.post.post_ID(),post_title:wp.fee.post.post_title(),post_name:wp.fee.post.post_name(),_wpnonce:wp.fee.nonces.slug}).done(function(a){B.setContent(a)})}),y.on("click.fee",function(){a.focus()}),a.on("activate focus",function(){e=!0}),a.on("deactivate blur hide",function(){e=!1,setTimeout(function(){d||y.slideUp("fast",function(){C.nodeChanged()})},100)})}}))}var s,t,u,v,w,x,y,z,A,B,C,D,E,F,G=window.tinymce,H=G.util.VK,I=window.feeL10n,J=!0,K=a(window),L=a(document),M=a(document.body),N=a(".fee-post"),O=a('a[href="#fee-edit-link"]'),P=a(".has-post-thumbnail"),Q=a(".fee-thumbnail"),R=a(".fee-thumbnail-wrap"),S=a(".fee-edit-thumbnail").add(".fee-insert-thumbnail"),T=a(".fee-remove-thumbnail"),U=a(".fee-toolbar"),V=U.find(".button").add(a(".fee-save-and-exit")),W=a(".fee-content"),X=a(".fee-content-original"),Y=a(".fee-categories"),Z=a(".fee-leave"),$=a("#fee-notice-area"),aa=W.parents(),ba=[],ca=0,da=!0,ea=0,fa={start:function(){ea||M.addClass("progress"),ea++},stop:function(){ea&&ea--,ea||M.removeClass("progress")}};wp.fee.post={},_.each(wp.fee.postOnServer,function(a,b){wp.fee.post[b]=function(){return wp.fee.postOnServer[b]}}),wp.fee.post.post_ID=function(){return wp.fee.postOnServer.ID||0},wp.fee.post.post_title=function(a,b){return a?(x&&(document.title=x.replace("<!--replace-->",a)),v.each(function(b,c){c.innerHTML=a}),b||(w.get(0).innerHTML=a),this.post_title()):A?A.getContent()||"":wp.fee.postOnServer.post_title},wp.fee.post.post_name=function(){return B?B.getContent()||"":""},wp.fee.post.post_content=function(a){var b;return a&&"raw"!==a&&"html"!==a?(C.undoManager.add(),C.setContent(a),this.post_content()):(b=C.getContent({format:a||"html"})||"","raw"!==a&&(b=b.replace(/<p>(?:<br ?\/?>|\u00a0|\uFEFF| )*<\/p>/g,"<p>&nbsp;</p>")),b)},wp.fee.post.post_category=function(){var b=[];return a('input[name="post_category[]"]:checked').each(function(){b.push(a(this).val())}),b},b(),G.init(_.extend(wp.fee.tinymce,{setup:function(a){C=a,window.wpActiveEditor=a.id,q(a),a.on("BeforeSetContent",function(a){a.content&&(a.content=a.content.replace(/<p>(?:&nbsp;|\s)+<\/p>/gi,"<p><br></p>"))})}})),r(),K.on("beforeunload.fee",function(){return!J&&l()?((event||window.event).returnValue=I.saveAlert,I.saveAlert):void 0}).on("unload.fee-remove-lock",function(a){da&&(a.target&&"#document"!==a.target.nodeName||wp.ajax.post("wp-remove-post-lock",{_wpnonce:wp.fee.nonces.post,post_ID:wp.fee.post.ID(),active_post_lock:wp.fee.lock}))}),L.on("fee-editor-init.fee",function(){(M.hasClass("fee-on")||-1!==document.location.hash.indexOf("edit=true"))&&c(),M.hasClass("fee-off")&&!Q.find("img").length&&P.removeClass("has-post-thumbnail"),L.on("autosave-restore-post",function(a,b){wp.fee.post.post_title(b.post_title),wp.fee.post.post_content(b.content)}),F=i(),wp.fee.postOnServer.post_content!==wp.fee.post.post_content()&&window.console.log("The content on the server and the content in the editor is different. This may be due to errors.")}).on("autosave-enable-buttons.fee",function(){V.prop("disabled",!1)}).on("autosave-disable-buttons.fee",function(){wp.heartbeat&&wp.heartbeat.hasConnectionError()||V.prop("disabled",!0)}).on("keydown.fee",function(a){83===a.keyCode&&H.metaKeyPressed(a)&&(a.preventDefault(),j()),27===a.keyCode&&(a.preventDefault(),d())}).on("heartbeat-send.fee-refresh-lock",function(a,b){b["wp-refresh-post-lock"]={post_id:wp.fee.post.ID(),lock:wp.fee.lock}}).on("heartbeat-tick.fee-refresh-lock",function(b,c){var d,e,f=c["wp-refresh-post-lock"];f&&(f.lock_error?(d=a("#post-lock-dialog"),d.length&&!d.is(":visible")&&(wp.autosave&&(L.one("heartbeat-tick",function(){wp.autosave.server.suspend(),d.removeClass("saving").addClass("saved"),K.off("beforeunload.edit-post")}),d.addClass("saving"),wp.autosave.server.triggerSave()),f.lock_error.avatar_src&&(e=a('<img class="avatar avatar-64 photo" width="64" height="64" />').attr("src",f.lock_error.avatar_src.replace(/&amp;/g,"&")),d.find("div.post-locked-avatar").empty().append(e)),d.show().find(".currently-editing").text(f.lock_error.text),d.find(".wp-tab-first").focus())):f.new_lock&&(wp.fee.lock=f.new_lock))}).on("heartbeat-send.fee-refresh-nonces",function(a,b){D&&(b["wp-refresh-post-nonces"]={post_id:wp.fee.post.ID(),post_nonce:wp.fee.nonces.post})}).on("heartbeat-tick.fee-refresh-nonces",function(a,c){var d=c["wp-refresh-post-nonces"];d&&(b(),d.heartbeatNonce&&(window.heartbeatSettings.nonce=d.heartbeatNonce))}).on("after-autosave",function(){s&&s.fadeOut("slow",function(){s.remove()})}),Y.on("click.fee",function(b){J||(b.preventDefault(),a(".fee-category-modal").modal("show"))}),a(".fee-category-modal").on("hide.bs.modal",function(){wp.ajax.post("fee_categories",{nonce:wp.fee.nonces.categories,post_ID:wp.fee.post.ID(),separator:Y.data("separator"),parents:Y.data("parents"),post_category:wp.fee.post.post_category()}).done(function(a){Y.html(a)})}),N.find('a[rel="tag"]').on("click.fee",function(a){a.preventDefault()}),N.find("time").add(N.find(".entry-date")).on("click.fee",function(a){a.preventDefault()}),N.find('a[rel="author"]').on("click.fee",function(a){a.preventDefault()}),a("a").not('a[href^="#"]').on("click.fee",function(b){var c=a(this);l()&&!H.metaKeyPressed(b)&&(b.preventDefault(),n(function(){e(c.attr("href"))}))}),a("#wp-admin-bar-edit-publish > a").on("click.fee",function(){event.preventDefault(),k()}),a("#wp-admin-bar-edit-save > a").on("click.fee",function(){event.preventDefault(),j()}),a("#wp-admin-bar-edit > a").on("click.fee",function(){event.preventDefault(),c()}),O.on("click.fee",function(a){a.preventDefault(),f()}),-1!==a.inArray(wp.fee.post.post_status(),["publish","future","private"])&&(a("#wp-admin-bar-edit-publish").hide(),a("#wp-admin-bar-edit-save > a").text("Update")),wp.fee.notices.autosave&&(s=o(wp.fee.notices.autosave,"error")),_.extend(wp.media.featuredImage,{set:function(a){var b=wp.media.view.settings;b.post.featuredImageId=a,wp.media.post("fee_thumbnail",{post_ID:b.post.id,thumbnail_ID:b.post.featuredImageId,_wpnonce:b.post.nonce,size:Q.data("size")}).done(function(a){R.html(a),Q.removeClass("fee-thumbnail-active"),""===a?Q.addClass("fee-empty"):Q.removeClass("fee-empty")})}}),S.on("click.fee-edit-thumbnail",function(){wp.media.featuredImage.frame().open()}),T.on("click.fee-remove-thumbnail",function(){wp.media.featuredImage.set(-1)}),Q.on("click.fee-thumbnail-active",function(){J||Q.hasClass("fee-empty")||(Q.addClass("fee-thumbnail-active"),L.on("click.fee-thumbnail-active",function(a){Q.get(0)===a.target||Q.has(a.target).length||(Q.removeClass("fee-thumbnail-active"),L.off("click.fee-thumbnail-active"))}))}),a(".categorydiv").each(function(){var b,c,d,e,f,g=a(this).attr("id");d=g.split("-"),d.shift(),e=d.join("-"),f=e+"_tab","category"===e&&(f="cats"),a("a","#"+e+"-tabs").click(function(){var b=a(this).attr("href");return a(this).parent().addClass("tabs").siblings("li").removeClass("tabs"),a("#"+e+"-tabs").siblings(".tabs-panel").hide(),a(b).show(),"#"+e+"-all"===b?window.deleteUserSetting(f):window.setUserSetting(f,"pop"),!1}),window.getUserSetting(f)&&a('a[href="#'+e+'-pop"]',"#"+e+"-tabs").click(),a("#new"+e).one("focus",function(){a(this).val("").removeClass("form-input-tip")}),a("#new"+e).keypress(function(b){13===b.keyCode&&(b.preventDefault(),a("#"+e+"-add-submit").click())}),a("#"+e+"-add-submit").click(function(){a("#new"+e).focus()}),b=function(b){return a("#new"+e).val()?(b.data+="&"+a(":checked","#"+e+"checklist").serialize(),a("#"+e+"-add-submit").prop("disabled",!0),b):!1},c=function(b,c){var d,f=a("#new"+e+"_parent");a("#"+e+"-add-submit").prop("disabled",!1),"undefined"!==c.parsed.responses[0]&&(d=c.parsed.responses[0].supplemental.newcat_parent)&&(f.before(d),f.remove())},a("#"+e+"checklist").wpList({alt:"",response:e+"-ajax-response",addBefore:b,addAfter:c}),a("#"+e+"-add-toggle").click(function(){return a("#"+e+"-adder").toggleClass("wp-hidden-children"),a('a[href="#'+e+'-all"]',"#"+e+"-tabs").click(),a("#new"+e).focus(),!1}),a("#"+e+"checklist, #"+e+"checklist-pop").on("click",'li.popular-category > label input[type="checkbox"]',function(){var b=a(this),c=b.is(":checked"),d=b.val();d&&b.parents("#taxonomy-"+e).length&&a("#in-"+e+"-"+d+", #in-popular-"+e+"-"+d).prop("checked",c)})}),_.extend(wp.fee,{on:c,off:d,toggle:f,isOn:g,isOff:h,isDirty:l,save:j,publish:k,addNotice:o,getPost:i})})}(jQuery);